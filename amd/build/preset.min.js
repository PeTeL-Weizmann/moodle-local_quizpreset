define(["jquery","core/templates","core/ajax","core/str","core/notification","local_quizpreset/userexposure","local_quizpreset/loading"],function(e,t,a,i,n,o,r){var l="",c="",u="#region-main .mform .collapsible-actions",d="#region-main .quizinfo",s=".collapsible-actions",p="#fgroup_id_buttonar",f="#fgroup_id_buttonar #id_submitbutton",m="#fgroup_id_buttonar #id_submitbutton2",_="#fgroup_id_buttonar #new_id_submitbutton",g="#fgroup_id_buttonar #new_id_submitbutton2",b=".quizinfo",h='input[name="cmid"]',v="#local-quizpreset-cmid",w='input[name="coursemodule"]',z="new_";e(h).length?l=e(h).val():e(v).length?l=e(v).val():e(w).length&&(l=e(w).val());var q=function(t,a){var i=e("#id_"+t).prop("type");"text"!=i&&"select-one"!=i||e("#id_"+t).val(a),"checkbox"==i&&(1==a?e("#id_"+t).prop("checked",!0):e("#id_"+t).prop("checked",!1))},k=function(){r.show();var i={};window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,a){i[t]=a});var b=new URL(window.location.href),h=b.searchParams.get("defaulttype"),v=b.searchParams.get("viewall");null===v&&(v=100),a.call([{methodname:"local_quizpreset_get_pagedata",args:{cmid:Number(l),defaulttype:Number(h),viewall:Number(v),pagestate:c,urlparams:JSON.stringify(i)},done:function(i){var b=JSON.parse(i);t.render("local_quizpreset/selector",b).done(function(i){e(u).length?e(u).before(i):e(d).length&&e(d).before(i),function(t){"view"!=t.details.pagestate&&"update"!=t.details.pagestate&&(q("name",t.global.name),e("#id_teacherremarkseditable").html(t.global.intro))}(b),function(t){"view"!=t.details.pagestate&&(1!=t.details.ifchangestate&&"new"!=t.details.pagestate||e.each(t.values,function(a,i){"area_checkboxes"!=a?q(a,i):e.each(t.values.area_checkboxes,function(e,t){q(e,t)})}))}(b),function(i){e(s).hide(),1==i.details.viewall_button_enable&&t.render("local_quizpreset/view_all_button",i).done(function(t){e(p).before(t)});var o=e(f).clone().insertAfter(f);o.attr("id",z+o.attr("id")),o.attr("name",z+o.attr("name")),o.attr("type","button"),e(f).hide();var r=function(t){var i=e("#defaulttype_for_save").val(),o=e("#viewall_for_save").val();a.call([{methodname:"local_quizpreset_savedata",args:{cmid:Number(l),pagestate:c,type:Number(i),viewall:Number(o)},done:function(){t&&t()},fail:n.exception}])},u=function(){e(f).click()},d=function(){e(m).click()},b=e(m).clone().insertAfter(m);b.attr("id",z+b.attr("id")),b.attr("name",z+b.attr("name")),b.attr("type","button"),e(m).hide(),e(document).on("click",_,function(){r(u)}),e(document).on("click",g,function(){r(d)})}(b),function(t){"view"!=t.details.pagestate&&(e.each(t.expanded,function(t,a){a||e("#"+t).hide()}),"chemistry"==t.details.instancename&&e("#id_teacherremarks").parents(".form-group").hide(),t.details.viewdescription||(e("#id_introeditor").parents(".form-group").hide(),e("#id_showdescription").parents(".form-group").hide()))}(b),o.init(),1==b.details.viewall&&e(".collapsible-actions").show(),e(function(){e('[data-toggle="tooltip"]').tooltip({delay:{show:700,hide:500}})}),r.remove()})},fail:n.exception}])};return{configureAddQuizPage:function(){c="new",k()},configureUpdateQuizPage:function(){c="update",k()},configureViewQuizPage:function(){var i;c="view",i=function(){k()},a.call([{methodname:"local_quizpreset_get_buttonsbar",args:{cmid:Number(l)},done:function(a){var n=JSON.parse(a);t.render("local_quizpreset/buttons_bar",n).done(function(t){e(b).before(t),i()})},fail:n.exception}])}}});